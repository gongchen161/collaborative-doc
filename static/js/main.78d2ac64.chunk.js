(this["webpackJsonpcollaborative-doc"]=this["webpackJsonpcollaborative-doc"]||[]).push([[0],{137:function(e,t,n){},291:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(16),s=n.n(r),i=n(26),o=n(20),l=n(104),u=n.n(l),d=(n(136),n(137),n(75));try{d.a.apps.length||(console.log("initializing firebase"),d.a.initializeApp({apiKey:"AIzaSyAMVQX5KUs7J-GGEKOItKkeLT8J0WS0C6Y",authDomain:"collaborative-doc.firebaseapp.com",projectId:"collaborative-doc",storageBucket:"collaborative-doc.appspot.com",messagingSenderId:"493522432245",appId:"1:493522432245:web:0ab116816f5ba3d74fd5bc"}))}catch(Oe){console.log("error initializing firebase",Oe)}var j=d.a,b=d.a.auth(),p=n(339),h=n(330),f=n(106),O=n.n(f),x=n(87),m=n.n(x),g=n(4),v=c.a.createContext();function w(){return Object(a.useContext)(v)}function k(e){var t=e.children,n=Object(a.useState)(),c=Object(i.a)(n,2),r=c[0],s=c[1],o=Object(a.useState)(!1),l=Object(i.a)(o,2),u=l[0],d=l[1],j=Object(a.useState)(""),p=Object(i.a)(j,2),h={user:r,openSnackbar:u,setOpenSnackbar:d,message:p[0],setMessage:p[1],sessionId:m()()};return Object(a.useEffect)((function(){return b.onAuthStateChanged((function(e){s(e)}))}),[]),Object(g.jsx)(v.Provider,{value:h,children:t})}var y=n(27),S=n.n(y),I=n(35),C=n(322),E=n(324),A=n(326),N=n(148),R=n(327),D=n(105),W=n.n(D),T=n(328),z=n(40),P=n.n(z),L=n(342),M=n(25),B=n(144),G=n.n(B),q=n(143),K=n.n(q),U=n(145),J=n(344),_=Object(C.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function V(e){var t=e.inDoc,n=_(),c=Object(o.g)(),r=Object(a.useState)(null),s=Object(i.a)(r,2),l=s[0],u=s[1],d=w(),p=d.openSnackbar,h=d.setOpenSnackbar,f=d.message,O=d.setMessage,x=d.user,v=d.sessionId,k=function(){var e=Object(I.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(null),e.prev=1,e.next=4,b.signOut();case 4:c.push("/login"),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),O(e.t0.message),h(!0);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(I.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(null),c.push("/profile");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(I.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m()(),e.prev=1,console.log("++++++ creating doc to firebase"),e.next=5,j.database().ref("testdb1").child("/".concat(x.uid,"-user")).push({docId:n});case 5:return e.next=7,j.database().ref("testdb1").child("/".concat(n,"-title")).push({sessionId:v,title:"Untitled"});case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(1),h(!0),O("Error on creating a new document"),e.abrupt("return");case 14:c.push("/doc/".concat(n));case 15:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)(E.a,{position:"static",children:[Object(g.jsx)(L.a,{anchorOrigin:{vertical:"top",horizontal:"center"},open:p,message:f,autoHideDuration:3e3,onClose:function(){h(!1),O("")}}),Object(g.jsxs)(A.a,{children:[Object(g.jsx)(R.a,{edge:"start",className:n.menuButton,color:"inherit","aria-label":"menu",children:Object(g.jsxs)(T.a,{component:M.b,to:"/home",color:"inherit",children:[" ",Object(g.jsx)(K.a,{})]})}),Object(g.jsx)(N.a,{variant:"h6",className:n.title,children:"Collaborative Doc"}),!x&&Object(g.jsxs)(T.a,{component:M.b,to:"/login",color:"inherit",children:[" ",Object(g.jsx)(P.a,{})," Log In"]}),x&&!t&&Object(g.jsxs)(T.a,{onClick:C,color:"inherit",children:[" ",Object(g.jsx)(G.a,{}),"   Create A New Doc"]}),x&&Object(g.jsxs)("div",{children:[Object(g.jsx)(T.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){u(e.currentTarget)},color:"inherit",children:Object(g.jsx)(W.a,{color:"inherit"})}),Object(g.jsxs)(U.a,{id:"simple-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:function(){u(null)},children:[Object(g.jsx)(J.a,{onClick:y,children:"Profile"}),Object(g.jsx)(J.a,{onClick:k,children:"Logout"})]})]})]})]})}var F=n(329);function H(){var e=Object(a.useRef)(),t=Object(a.useState)(""),n=Object(i.a)(t,2),c=(n[0],n[1],Object(a.useState)("Untitled")),r=Object(i.a)(c,2),s=r[0],l=r[1],d=Object(o.h)().docId,b=Object(a.createRef)(),f=Object(a.useState)(!1),x=Object(i.a)(f,2),m=x[0],v=x[1],k=w(),y=k.user,S=k.sessionId,I=k.setOpenSnackbar,C=k.setMessage,E=Object(o.g)(),A=Object(a.useState)(!1),N=Object(i.a)(A,2),R=N[0],D=N[1];Object(a.useEffect)((function(){y||E.push("/login")}),[]),Object(a.useEffect)((function(){D(!0);try{j.database().ref("testdb1").child("/".concat(d,"-content")).on("child_added",(function(t){console.log("------ fetching content from firebase");var n=t.val();e&&e.current&&n.sessionId!==S&&e.current.getEditor().updateContents(n.delta)})),j.database().ref("testdb1").child("/".concat(d,"-title")).limitToLast(1).on("child_added",(function(e){console.log("------ fetching title from firebase");var t=e.val();l(t.title)}))}catch(Oe){console.log("error loading from firebse",Oe)}setTimeout((function(){D(!1)}),1500)}),[]);var W=function(e){e&&0!==e.trim().length&&(console.log("++++++ uploading title to firebase"),j.database().ref("testdb1").child("/".concat(d,"-title")).push({sessionId:S,title:e}))};return Object(g.jsxs)("div",{children:[Object(g.jsx)(V,{inDoc:!0}),R&&Object(g.jsx)("div",{children:Object(g.jsx)(F.a,{color:"secondary",disableShrink:!0,size:80,thickness:10})}),Object(g.jsx)(p.a,{id:"standard-full-width",placeholder:"   Document Title",fullWidth:!0,value:s,margin:"normal",InputLabelProps:{shrink:!0},inputRef:b,disabled:m||R,readOnly:!0,onChange:function(e){if(0===e.target.value.trim().length)return I(!0),void C("Title cannot be empty");l(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(b.current.blur(),v(!0),W(b.current.value))},onClick:function(){v(!1)},onFocus:function(){v(!1),console.log(22)},onBlur:function(){v(!0),console.log(333),W(b.current.value)},InputProps:{startAdornment:Object(g.jsx)(h.a,{position:"start",children:Object(g.jsx)(O.a,{})})}}),Object(g.jsx)(u.a,{theme:"snow",onChange:function(e,t,n,a){"user"===n&&(console.log("++++++ uploading delta to firebase"),j.database().ref("testdb1").child("/".concat(d,"-content")).push({sessionId:S,delta:t}))},readOnly:R,ref:e})]})}var Q=n(343),X=n(332),Y=n(334),Z=n(333),$=n(331),ee=Object(C.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},icon:{margin:e.spacing(1),backgroundColor:e.palette.primary.dark},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)}}}));function te(){var e=ee(),t=Object(a.useRef)(),n=Object(a.useRef)(),c=Object(a.useRef)(),r=w(),s=r.setOpenSnackbar,i=r.setMessage,l=r.user,u=Object(o.g)();Object(a.useEffect)((function(){l&&u.push("/home")}),[]);var d=function(){var e=Object(I.a)(S.a.mark((function e(a){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),n.current.value===c.current.value){e.next=5;break}return i("password does not match"),s(!0),e.abrupt("return");case 5:return e.prev=5,e.next=8,b.createUserWithEmailAndPassword(t.current.value,n.current.value);case 8:u.push("/home"),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(5),console.log(e.t0),i(e.t0.message),s(!0);case 16:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)("div",{children:[Object(g.jsx)(V,{}),Object(g.jsxs)($.a,{component:"main",maxWidth:"xs",children:[Object(g.jsx)(X.a,{}),Object(g.jsxs)("div",{className:e.paper,children:[Object(g.jsx)(Q.a,{className:e.icon,children:Object(g.jsx)(P.a,{})}),Object(g.jsx)(N.a,{component:"h1",variant:"h5",children:"Sign up"}),Object(g.jsxs)("form",{className:e.form,noValidate:!0,children:[Object(g.jsxs)(Z.a,{container:!0,spacing:2,children:[Object(g.jsx)(Z.a,{item:!0,xs:12,children:Object(g.jsx)(p.a,{variant:"outlined",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",inputRef:t})}),Object(g.jsx)(Z.a,{item:!0,xs:12,children:Object(g.jsx)(p.a,{variant:"outlined",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",inputRef:n})}),Object(g.jsx)(Z.a,{item:!0,xs:12,children:Object(g.jsx)(p.a,{variant:"outlined",required:!0,fullWidth:!0,name:"password2",label:"Confirm Password",type:"password",id:"password2",inputRef:c})})]}),Object(g.jsx)(T.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:e.submit,onClick:d,children:"Sign Up"}),Object(g.jsx)(Z.a,{container:!0,justifyContent:"flex-end",children:Object(g.jsx)(Z.a,{item:!0,children:Object(g.jsx)(Y.a,{href:"#/login",variant:"body2",children:"Already have an account? Sign in"})})})]})]})]})]})}var ne=Object(C.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},icon:{margin:e.spacing(1),backgroundColor:e.palette.primary.dark},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)}}}));function ae(){var e=ne(),t=Object(a.useRef)(),n=Object(a.useRef)(),c=Object(o.g)(),r=w(),s=r.setOpenSnackbar,i=r.setMessage,l=r.user;Object(a.useEffect)((function(){l&&c.push("/home")}),[]);var u=function(){var e=Object(I.a)(S.a.mark((function e(a){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,b.signInWithEmailAndPassword(t.current.value,n.current.value);case 4:c.push("/home"),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),i(e.t0.message),s(!0);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)("div",{children:[Object(g.jsx)(V,{}),Object(g.jsxs)($.a,{component:"main",maxWidth:"xs",children:[Object(g.jsx)(X.a,{}),Object(g.jsxs)("div",{className:e.paper,children:[Object(g.jsx)(Q.a,{className:e.icon,children:Object(g.jsx)(P.a,{})}),Object(g.jsx)(N.a,{component:"h1",variant:"h5",children:"Login"}),Object(g.jsxs)("form",{className:e.form,noValidate:!0,children:[Object(g.jsxs)(Z.a,{container:!0,spacing:2,children:[Object(g.jsx)(Z.a,{item:!0,xs:12,children:Object(g.jsx)(p.a,{variant:"outlined",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",inputRef:t})}),Object(g.jsx)(Z.a,{item:!0,xs:12,children:Object(g.jsx)(p.a,{variant:"outlined",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",inputRef:n})})]}),Object(g.jsx)(T.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:e.submit,onClick:u,children:"Log In"}),Object(g.jsx)(Z.a,{container:!0,justifyContent:"flex-end",children:Object(g.jsx)(Z.a,{item:!0,children:Object(g.jsx)(Y.a,{href:"#/signup",variant:"body2",children:"Don't have an account? Sign up"})})})]})]})]})]})}var ce=n(111),re=n(340),se=n(107),ie=n.n(se),oe=n(336),le=n(338),ue=n(337),de=n(335),je=Object(C.a)((function(e){return{root:{flexGrow:1},paper:{padding:e.spacing(2),textAlign:"left",verticalAlign:"middle",color:e.palette.text.secondary,fontSize:"30px"}}}));var be=function(){var e=w().user,t=je(),n=Object(o.g)(),c=Object(a.useState)([]),r=Object(i.a)(c,2),s=r[0],l=r[1],u=Object(a.useState)(!1),d=Object(i.a)(u,2),b=d[0],p=d[1];return Object(a.useEffect)(Object(I.a)(S.a.mark((function t(){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return n.push("/login"),t.abrupt("return");case 3:return console.log("start loading"),p(!0),console.log("done loading"),t.next=8,j.database().ref("testdb1").child("/".concat(e.uid,"-user")).once("child_added",(function(e){console.log("------ fetching user from firebase");var t=e.val();t&&j.database().ref("testdb1").child("/".concat(t.docId,"-title")).limitToLast(1).once("child_added",(function(e){console.log("------ fetching user-title from firebase");var n=e.val();l((function(e){return[].concat(Object(ce.a)(e),[{docId:t.docId,title:n.title}])}))}))}));case 8:console.log(s),setTimeout((function(){p(!1)}),1500);case 10:case"end":return t.stop()}}),t)}))),[]),console.log("home page rendering"),Object(g.jsxs)("div",{children:[Object(g.jsx)(V,{}),b&&Object(g.jsxs)("div",{className:"center",children:[Object(g.jsx)(de.a,{color:"primary",size:60}),Object(g.jsx)(N.a,{variant:"h5",children:"Loading Docs..."})]}),!b&&Object(g.jsx)(re.a,{m:2,pt:3,children:Object(g.jsx)(Z.a,{container:!0,spacing:3,children:Object(ce.a)(s).map((function(e,n){return Object(g.jsx)(Z.a,{item:!0,xs:4,children:Object(g.jsx)(oe.a,{className:t.root,children:Object(g.jsx)(ue.a,{component:M.b,to:"/doc/".concat(e.docId),children:Object(g.jsxs)(le.a,{className:t.paper,children:[Object(g.jsx)(ie.a,{}),Object(g.jsxs)(N.a,{variant:"h6",children:[" ",e.title]})]})})})},e.docId)}))})})]})},pe=Object(C.a)((function(e){return{root:{flexGrow:1},paper:{padding:e.spacing(2),textAlign:"left",verticalAlign:"middle",color:e.palette.text.secondary,fontSize:"30px"}}}));var he=function(){var e=w().user,t=(pe(),Object(o.g)()),n=Object(a.useState)([]),c=Object(i.a)(n,2);return c[0],c[1],Object(a.useEffect)((function(){e||t.push("/login")}),[]),Object(g.jsxs)("div",{children:[Object(g.jsx)(V,{}),Object(g.jsxs)(oe.a,{className:"center",children:[Object(g.jsx)(P.a,{color:"primary",size:44,children:" "}),Object(g.jsxs)(N.a,{children:["Email: ",e.email]})]})]})};var fe=function(){return Object(g.jsx)(k,{children:Object(g.jsx)(M.a,{children:Object(g.jsxs)(o.d,{children:[Object(g.jsx)(o.b,{exact:!0,path:"/",children:Object(g.jsx)(o.a,{to:"/home"})}),Object(g.jsx)(o.b,{exact:!0,path:"/signup",children:Object(g.jsx)(te,{})}),Object(g.jsx)(o.b,{exact:!0,path:"/login",children:Object(g.jsx)(ae,{})}),Object(g.jsx)(o.b,{exact:!0,path:"/home",children:Object(g.jsx)(be,{})}),Object(g.jsx)(o.b,{exact:!0,path:"/profile",children:Object(g.jsx)(he,{})}),Object(g.jsx)(o.b,{path:"/doc/:docId",children:Object(g.jsx)(H,{})})]})})})};s.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(fe,{})}),document.getElementById("root"))}},[[291,1,2]]]);
//# sourceMappingURL=main.78d2ac64.chunk.js.map